javascript:(function(){if(window.UPFONES_BOOKMARKLET_ACTIVE)return;window.UPFONES_BOOKMARKLET_ACTIVE=true;const $=(t,p={},c={})=>{const e=document.createElement(t);Object.assign(e,p);Object.assign(e.style,c);return e};const style=document.createElement('style');style.id='upfones-style';style.textContent='#upfones-bubble{position:fixed;right:20px;bottom:20px;width:64px;height:64px;border-radius:50%;display:flex;align-items:center;justify-content:center;z-index:2147483647;box-shadow:0 8px 24px rgba(0,0,0,.35);cursor:pointer;user-select:none;transform-origin:center;transition:transform .25s ease,opacity .25s ease}#upfones-bubble:hover{transform:scale(1.08)}#upfones-bubble .label{font-family:Segoe UI,Roboto,Arial,sans-serif;font-size:11px;color:#fff;font-weight:700;pointer-events:none}#upfones-panel{position:fixed;right:100px;bottom:30px;width:380px;max-width:90vw;background:linear-gradient(180deg, rgba(255,255,255,0.98), #f6f7fb);border-radius:12px;padding:12px;box-shadow:0 18px 40px rgba(10,10,30,.35);z-index:2147483647;display:flex;flex-direction:column;gap:8px;transform:translateY(20px);opacity:0;transition:opacity .22s ease,transform .22s ease}#upfones-panel.show{opacity:1;transform:translateY(0)}#upfones-playlist{max-height:160px;overflow:auto;padding:6px;border-radius:8px;background:rgba(0,0,0,0.02);font-family:Segoe UI,Roboto,Arial,sans-serif}.track{display:flex;align-items:center;justify-content:space-between;padding:6px;border-radius:6px;margin-bottom:6px}button.upf{padding:8px 10px;border-radius:8px;border:0;cursor:pointer;font-weight:600}.small{font-size:12px}#upf-ytwrap{width:100%;height:200px;background:#000;border-radius:8px;overflow:hidden;display:flex;align-items:center;justify-content:center}';document.head.appendChild(style);const bubble=$('div',{id:'upfones-bubble',innerHTML:'<div class=\"label\">UPfones</div>'},{background:'linear-gradient(135deg,#6d28d9,#ef4444)',color:'#fff'});document.body.appendChild(bubble);const panel=$('div',{id:'upfones-panel'});panel.innerHTML='<div style=\"display:flex;align-items:center;justify-content:space-between\"><div style=\"display:flex;gap:8px;align-items:center\"><strong>UPfones</strong><span class=\"small\">player</span></div><div style=\"display:flex;gap:6px;align-items:center\"><button id=\"upf-add\" class=\"upf small\">Adicionar URL</button><button id=\"upf-clear\" class=\"upf small\">Limpar</button><button id=\"upf-close\" class=\"upf small\">Fechar</button></div></div><div id=\"upf-ytwrap\" style=\"display:none\"></div><div id=\"upf-player\"><audio id=\"upf-audio\" controls style=\"width:100%;display:block\"></audio></div><div style=\"display:flex;gap:8px;align-items:center;justify-content:center\" id=\"upf-controls-row\"></div><div id=\"upf-playlist\" class=\"small\"></div><div style=\"font-size:11px;color:#666;text-align:center\">Suporta: links diretos de áudio (.mp3/.ogg) e URLs do YouTube. Não remove anúncios do YouTube.</div>';document.body.appendChild(panel);(function makeDraggable(el){let isDown=false,startX,startY,origR,origB;el.style.right='100px';el.style.bottom='30px';el.addEventListener('pointerdown',e=>{if(e.target.closest('button')||e.target.tagName==='INPUT'||e.target.tagName==='A'||e.target.closest('#upf-player'))return;isDown=true;el.setPointerCapture(e.pointerId);startX=e.clientX;startY=e.clientY;const rect=el.getBoundingClientRect();origR=rect.right;origB=rect.bottom});document.addEventListener('pointermove',e=>{if(!isDown)return;const dx=startX-e.clientX;const dy=startY-e.clientY;const newRight=Math.max(8,origR+dx);const newBottom=Math.max(8,origB+dy);el.style.right=(window.innerWidth-newRight)+'px';el.style.bottom=(window.innerHeight-newBottom)+'px'});document.addEventListener('pointerup',e=>{if(isDown){isDown=false;try{e.target.releasePointerCapture&&e.target.releasePointerCapture(e.pointerId)}catch(err){}}})})(panel);const audio=panel.querySelector('#upf-audio');const ytWrap=panel.querySelector('#upf-ytwrap');const playlistDiv=panel.querySelector('#upf-playlist');const addBtn=panel.querySelector('#upf-add');const clearBtn=panel.querySelector('#upf-clear');const closeBtn=panel.querySelector('#upf-close');const LSKEY='upfones_playlist_v2';let playlist=JSON.parse(localStorage.getItem(LSKEY)||'[]');let current=0;let YTAPIReady=!!window.YT&&!!window.YT.Player;let ytPlayer=null;let pendingYouTubeId=null;function loadYouTubeAPI(cb){if(YTAPIReady){cb&&cb();return}if(window._upf_loading_ytapi){const interval=setInterval(()=>{if(window.YT&&window.YT.Player){clearInterval(interval);YTAPIReady=true;cb&&cb()}},200);return}window._upf_loading_ytapi=true;const s=document.createElement('script');s.src='https://www.youtube.com/iframe_api';document.head.appendChild(s);window.onYouTubeIframeAPIReady=function(){YTAPIReady=true;cb&&cb()};}function createYouTubePlayer(videoId){ytWrap.innerHTML='<div id=\"upf-ytplayer\" style=\"width:100%;height:100%\"></div>';if(!YTAPIReady){pendingYouTubeId=videoId;loadYouTubeAPI(()=>{if(pendingYouTubeId)createYouTubePlayer(pendingYouTubeId);pendingYouTubeId=null});return}if(ytPlayer){try{ytPlayer.destroy()}catch(e){}ytPlayer=null}ytPlayer=new YT.Player('upf-ytplayer',{height:'100%',width:'100%',videoId:videoId,playerVars:{rel:0,modestbranding:1,controls:1},events:{onStateChange:function(e){}}});}function parseYouTubeId(url){try{if(typeof url!=='string')return null;const u=url.trim();const ytShort=/youtu\\.be\\/([A-Za-z0-9_-]{6,})/i.exec(u);if(ytShort)return ytShort[1];const ytWatch=/[?&]v=([A-Za-z0-9_-]{6,})/i.exec(u);if(ytWatch)return ytWatch[1];const ytEmbed=/youtube\\.com\\/embed\\/([A-Za-z0-9_-]{6,})/i.exec(u);if(ytEmbed)return ytEmbed[1];return null}catch(e){return null}}function save(){localStorage.setItem(LSKEY,JSON.stringify(playlist))}function renderPlaylist(){playlistDiv.innerHTML='';if(playlist.length===0){playlistDiv.innerHTML='<div style=\"opacity:.6;padding:8px\">Playlist vazia — clique em \"Adicionar URL\" e cole um link direto (.mp3/.ogg) ou uma URL do YouTube.</div>';return}playlist.forEach((t,i)=>{const tr=document.createElement('div');tr.className='track';tr.innerHTML=`<div style=\"display:flex;gap:8px;align-items:center;flex:1\"><div style=\"width:8px;height:8px;border-radius:50%;background:${i===current? '#10b981':'#cbd5e1'}\"></div><div style=\"flex:1;overflow:hidden;text-overflow:ellipsis;white-space:nowrap\">${t.name||t.url}</div></div><div style=\"display:flex;gap:6px\"><button data-i=\"${i}\" class=\"upf small play-track\">Play</button><button data-i=\"${i}\" class=\"upf small remove-track\">Rem</button></div>`;playlistDiv.appendChild(tr)});playlistDiv.querySelectorAll('.play-track').forEach(b=>b.addEventListener('click',e=>{const i=Number(e.currentTarget.dataset.i);playIndex(i)}));playlistDiv.querySelectorAll('.remove-track').forEach(b=>b.addEventListener('click',e=>{const i=Number(e.currentTarget.dataset.i);playlist.splice(i,1);if(current>=playlist.length)current=Math.max(0,playlist.length-1);save();renderPlaylist()}))}function showAudioUI(){audio.style.display='block';ytWrap.style.display='none'}function showYouTubeUI(){audio.style.display='none';ytWrap.style.display='block'}function playIndex(i){if(!playlist[i])return;current=i;const item=playlist[i];save();renderPlaylist();if(item.platform==='youtube'){showYouTubeUI();createYouTubePlayer(item.id)}else{showAudioUI();audio.src=item.url;audio.play().catch(()=>{})}}const controlsRow=panel.querySelector('#upf-controls-row');const btnPrev=$('button',{innerText:'⏮'},{width:'44px'});const btnPlay=$('button',{innerText:'▶️'},{width:'44px'});const btnNext=$('button',{innerText:'⏭'},{width:'44px'});const btnAddURL=$('button',{innerText:'+ URL'},{padding:'8px 12px',borderRadius:'8px'});controlsRow.appendChild(btnPrev);controlsRow.appendChild(btnPlay);controlsRow.appendChild(btnNext);controlsRow.appendChild(btnAddURL);function togglePanel(){panel.classList.toggle('show')}bubble.addEventListener('click',()=>togglePanel());addBtn.addEventListener('click',()=>{const url=prompt('Cole aqui a URL (YouTube ou link direto .mp3/.ogg):');if(!url)return;const name=prompt('Nome (opcional) para mostrar na playlist:','')||'';const ytid=parseYouTubeId(url);if(ytid){playlist.push({platform:'youtube',url:url.trim(),id:ytid,name:name.trim()});}else{playlist.push({platform:'audio',url:url.trim(),name:name.trim()});}save();renderPlaylist();playIndex(playlist.length-1)});btnAddURL.addEventListener('click',()=>addBtn.click());btnPrev.addEventListener('click',()=>{if(playlist.length===0)return;current=(current-1+playlist.length)%playlist.length;playIndex(current)});btnNext.addEventListener('click',()=>{if(playlist.length===0)return;current=(current+1)%playlist.length;playIndex(current)});btnPlay.addEventListener('click',()=>{const currentItem=playlist[current];if(currentItem&&currentItem.platform==='youtube'){if(!ytPlayer){createYouTubePlayer(currentItem.id);return}const state=ytPlayer.getPlayerState?ytPlayer.getPlayerState():-1;if(state===1)ytPlayer.pauseVideo();else ytPlayer.playVideo();}else{if(!audio.src&&playlist.length>0){playIndex(0);return}if(audio.paused)audio.play().catch(()=>{});else audio.pause()}});audio.addEventListener('play',()=>btnPlay.innerText='⏸');audio.addEventListener('pause',()=>btnPlay.innerText='▶️');audio.addEventListener('ended',()=>{if(playlist.length>0){current=(current+1)%playlist.length;playIndex(current)}});clearBtn.addEventListener('click',()=>{if(confirm('Limpar playlist e histórico?')){playlist=[];save();renderPlaylist();audio.pause();audio.src='';ytWrap.innerHTML='';}});closeBtn.addEventListener('click',()=>panel.classList.remove('show'));renderPlaylist();bubble.style.opacity='0';bubble.style.transform='scale(.3)';setTimeout(()=>{bubble.style.opacity='1';bubble.style.transform='scale(1)'},50);if(!localStorage.getItem('upfones_seen_tip')){setTimeout(()=>{alert('UPfones: clique na bolinha para abrir o player. Cole links diretos de áudio ou URLs do YouTube. Não pule anúncios do YouTube.');localStorage.setItem('upfones_seen_tip','1')},700)}window.UPFONES_REMOVE=function(){try{document.getElementById('upfones-style')?.remove();bubble.remove();panel.remove();delete window.UPFONES_BOOKMARKLET_ACTIVE;delete window.UPFONES_REMOVE}catch(e){}};})();